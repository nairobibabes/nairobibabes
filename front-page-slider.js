"use strict";!function(i){"undefined"==typeof EdgeCms&&(window.EdgeCms={}),EdgeCms.FrontPageSlider={slider:void 0,sliderItems:void 0,videoPlaying:void 0,rotateToggle:void 0,videoToggle:void 0,videoWaitTimeout:void 0,sliderInterval:4e3,videoWaitAmount:2500,allowVideos:!0,rotateSlides:!0,videoMuted:!0,scrollThrottling:!1,init:function(){this.loadSecondAndLastSlides(),this.getReferences(),this.slider.carousel({interval:this.sliderInterval,keyboard:!0,ride:"carousel",wrap:!0}),this.attachEvents(),this.playFirstSlideMovie()},loadSecondAndLastSlides:function(){var e=i(".carousel-inner > .carousel-item"),t=e.last(),o=i(e[1]);this.loadSlide(t),this.loadSlide(o)},playFirstSlideMovie:function(){var i=this.slider.find(".carousel-item.active").find("video");0!=i.length&&(this.videoWaitTimeout=setTimeout(this.playVideo.bind(this,i),this.videoWaitAmount))},loadSlide:function(i){var e=i.find("img[data-src]");if(0!=e.length)return e.attr("src",e.data("src")),void e.removeAttr("data-src");var t=i.find("video[data-src]");0!=t.length&&(t.attr("src",t.data("src")),t.removeAttr("data-src")),t.length>0&&t.data("postersrc")&&(t.attr("poster",t.data("postersrc")),t.removeAttr("data-postersrc"))},getReferences:function(){this.slider=i("#frontPageSliderContainer"),this.sliderItems=this.slider.find(".carousel-item"),this.rotateToggle=i("#frontPageSliderRotateToggle"),this.videoToggle=i("#frontPageSliderVideoToggle")},attachEvents:function(){this.sliderItems.on("click",".close",function(i){NubileSlider.hidePricing()}),this.slider.on("slid.bs.carousel",this.onSlideChange.bind(this)),this.rotateToggle.on("change",this.onRotateToggle.bind(this)),this.videoToggle.on("change",this.onVideoToggle.bind(this)),this.slider.find('[data-slide="prev"]').on("click touchend",function(){this.slider.carousel("prev")}.bind(this)),this.slider.find('[data-slide="next"]').on("click touchend",function(){this.slider.carousel("next")}.bind(this)),i(window).blur(this.onWindowBlur.bind(this)),i(window).focus(this.onWindowFocus.bind(this)),i(window).scroll(this.onWindowScroll.bind(this))},playVideo:function(e){this.stopCurrentVideo(),this.videoPlaying=e;var t=this.getVideoSourceForScreenSize(e,i(window).width());e.attr("src",t.getAttribute("src")),e[0].muted=this.videoMuted,e[0].autoplay=!1,e[0].currentTime&&(e[0].currentTime=0);var o=e[0].play();void 0!==o&&o.catch(function(i){console.log("caught an error trying to play a video slider")}),this.pauseSlider(),e.on("ended",this.onVideoEnded.bind(this))},stopCurrentVideo:function(){if(this.isVideoCurrentlyPlaying()){var i=this.videoPlaying[0].pause();void 0!==i&&i.catch(function(i){console.log("caught an error trying to pause a video slider")}),this.onVideoEnded()}},getVideoSourceForScreenSize:function(e,t){var o=e.find("source"),s=[];o.each(function(){var e=i(this).data("dim"),t=e.substr(0,e.indexOf("x"));s.push(Number(t))});for(var n=0,d=s[0],r=1;r<s.length;r++)s[r]<d&&s[r]>t&&(n=r,d=s[r]);return o[n]},onSlideChange:function(e){this.stopCurrentVideo(this.videoPlaying);var t=i(e.target).find(".carousel-item.active");if(clearTimeout(this.videoWaitTimeout),this.loadSlide(t.prev()),this.loadSlide(t.next()),this.allowVideos){var o=t.find("video");0!=o.length&&(this.videoWaitTimeout=setTimeout(this.playVideo.bind(this,o),this.videoWaitAmount))}},onVideoEnded:function(){this.rotateSlides&&this.resumeSlider(),this.videoPlaying.off("ended"),this.videoPlaying=void 0},onRotateToggle:function(i){var e=i.target.checked;e!=this.rotateSlides&&(e?this.resumeSlider():this.pauseSlider(),this.rotateSlides=e)},onVideoToggle:function(i){var e=i.target.checked;e||this.stopCurrentVideo(),this.allowVideos=e},onWindowBlur:function(){this.pauseSlider()},onWindowFocus:function(){this.rotateSlides&&this.resumeSlider()},onWindowScroll:function(){if(!this.scrollThrottling){this.scrollThrottling=!0,setTimeout(function(){this.scrollThrottling=!1}.bind(this),500);var e=i(window).scrollTop(),t=e+i(window).height(),o=this.slider.offset().top,s=o+this.slider.height();this.slider.is(":visible")&&(s<=t&&s>=e||o<=e&&o>=t)?this.rotateSlides&&this.resumeSlider():this.pauseSlider()}},pauseSlider:function(){this.slider.carousel("pause")},resumeSlider:function(){this.slider.carousel("cycle")},showCaption:function(){i(".carousel-item.active").find(".carousel-caption").show()},hideCaption:function(){i(".carousel-item.active").find(".carousel-caption").hide()},hidePricing:function(e){i(".carousel-item.active .pricing").fadeOut()},hideCurrentItemImage:function(){i(".carousel-item.active > a > img").hide()},showCurrentItemImage:function(){i(".carousel-item.active > a > img").show()},isVideoCurrentlyPlaying:function(){return void 0!==this.videoPlaying}},EdgeCms.FrontPageSlider.init()}(jQuery);