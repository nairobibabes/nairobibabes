"use strict";!function(t){"undefined"==typeof EdgeCms&&(window.EdgeCms={});var i=".lazy";EdgeCms.TubeGrid={hiddenThumbs:[],videoPlayersBelowFold:[],thumbsShown:{},appearingTimeout:void 0,$grid:null,$thumbs:null,$videoThumbs:null,$hiddenThumbs:null,construct:function(){this.grabReferences(),this.attachEvents(),this.hideRemainderThumbs(),this.applyLazyLoad()},grabReferences:function(){this.$grid=t(".tube-grid"),this.$thumbs=t(".thumb"),this.$videoThumbs=t(".tube-grid .video-thumb")},attachEvents:function(){this.$thumbs.on("appear",this.onThumbVisible.bind(this)),this.$thumbs.on("click ontouchend",this.onThumbClick.bind(this)),this.attachEventForVideoThumbAutoPlay()},recalculateHiddenThumbs:function(){this.showHiddenThumbs(),this.hideRemainderThumbs()},getNumberOfThumbs:function(){return this.$thumbs.length},getGridWidth:function(){return this.$grid.innerWidth()},getThumbWidth:function(){return this.$thumbs.outerWidth()},getItemsPerRow:function(){return parseInt(this.getGridWidth()/this.getThumbWidth())},getNumberOfThumbsToHide:function(){return parseInt(this.getNumberOfThumbs()%this.getItemsPerRow())},hideRemainderThumbs:function(){var t=this.getNumberOfThumbsToHide();0!=t&&(this.$hiddenThumbs=this.$thumbs.slice(-1*t),this.$hiddenThumbs.hide())},showHiddenThumbs:function(){!this.$hiddenThumbs||this.$hiddenThumbs.length<=0||(this.$hiddenThumbs.show(),this.$hiddenThumbs=null)},applyLazyLoad:function(){0!=t(i).length&&t(i).show().lazyload({effect:"fadeIn",threshold:400})},onThumbVisible:function(){var i=this;clearTimeout(this.appearingTimeout),this.appearingTimeout=setTimeout(function(){t(".lazy").each(function(e,h){if(t(h).is("[style]")){var n=t(h).attr("tube_tour_thumb_id");i.thumbsShown[n]=n}});var e=Object.keys(i.thumbsShown);e.length>250&&e.splice(0,e.length-250),t.cookie("tube_tour_thumbs_displayed",e.join(","),{path:"/"})},200)},onThumbClick:function(i){var e=t(i.delegateTarget).find("[tube_tour_thumb_id]").attr("tube_tour_thumb_id");t.cookie("tube_tour_thumb_clicked",e,{path:"/"})},attachEventForVideoThumbAutoPlay:function(){this.videoPlayersBelowFold=this.$videoThumbs.find(".video-thumb-player");var i=this.videoPlayersBelowFold,e=this,h={container:window,threshold:0};function n(){i.each(function(){var i=t(this);i.is(":visible")&&(t.belowthefold(this,h)||t.rightoffold(this,h)||i.trigger("appear"))})}t(window).on("scroll resize",n),i.each(function(i,h){t(h).on("appear",function(){var i=t(this).attr("tube_tour_thumb_id");e.thumbsShown[i]=i;var h=videojs(t(this).attr("id")).play();void 0!==h&&h.catch(function(t){console.log("caught an error trying to play a tube thumb")}),t(this).off("appear")})}),n()}},EdgeCms.TubeGrid.construct(),t(window).on("resize",function(){EdgeCms.TubeGrid.recalculateHiddenThumbs()})}(jQuery);